{"version":3,"file":"comando-reverter.js","sourceRoot":"","sources":["../../src/cli/comando-reverter.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\r\nimport { Command } from 'commander';\r\nimport { mapaReversao } from '@zeladores/mapa-reversao.js';\r\nimport { log } from '@nucleo/constelacao/log.js';\r\n\r\nexport function registrarComandoReverter(program: Command) {\r\n  program\r\n    .command('reverter')\r\n    .description('Gerencia mapa de revers√£o para moves aplicados')\r\n    .addCommand(\r\n      new Command('listar')\r\n        .description('Lista todos os moves registrados no mapa de revers√£o')\r\n        .action(async () => {\r\n          await mapaReversao.carregar();\r\n          const lista = mapaReversao.listarMoves();\r\n          console.log(lista);\r\n        }),\r\n    )\r\n    .addCommand(\r\n      new Command('arquivo')\r\n        .description('Reverte todos os moves de um arquivo espec√≠fico')\r\n        .argument('<arquivo>', 'Caminho do arquivo para reverter')\r\n        .action(async (arquivo: string) => {\r\n          await mapaReversao.carregar();\r\n\r\n          if (!mapaReversao.podeReverterArquivo(arquivo)) {\r\n            log.erro(`‚ùå Nenhum move encontrado para o arquivo: ${arquivo}`);\r\n            if (!process.env.VITEST) process.exit(1);\r\n            else {\r\n              process.exitCode = 1;\r\n              return;\r\n            }\r\n          }\r\n\r\n          log.info(`üîÑ Revertendo moves para: ${arquivo}`);\r\n          const sucesso = await mapaReversao.reverterArquivo(arquivo);\r\n\r\n          if (sucesso) {\r\n            log.sucesso(`‚úÖ Arquivo revertido com sucesso: ${arquivo}`);\r\n          } else {\r\n            log.erro(`‚ùå Falha ao reverter arquivo: ${arquivo}`);\r\n            if (!process.env.VITEST) process.exit(1);\r\n            else {\r\n              process.exitCode = 1;\r\n              return;\r\n            }\r\n          }\r\n        }),\r\n    )\r\n    .addCommand(\r\n      new Command('move')\r\n        .description('Reverte um move espec√≠fico pelo ID')\r\n        .argument('<id>', 'ID do move para reverter')\r\n        .action(async (id: string) => {\r\n          await mapaReversao.carregar();\r\n\r\n          log.info(`üîÑ Revertendo move: ${id}`);\r\n          const sucesso = await mapaReversao.reverterMove(id);\r\n\r\n          if (sucesso) {\r\n            log.sucesso(`‚úÖ Move revertido com sucesso: ${id}`);\r\n          } else {\r\n            log.erro(`‚ùå Falha ao reverter move: ${id}`);\r\n            if (!process.env.VITEST) process.exit(1);\r\n            else {\r\n              process.exitCode = 1;\r\n              return;\r\n            }\r\n          }\r\n        }),\r\n    )\r\n    .addCommand(\r\n      new Command('limpar')\r\n        .description('Limpa todo o mapa de revers√£o (perde hist√≥rico)')\r\n        .option('-f, --force', 'N√£o pede confirma√ß√£o')\r\n        .action(async (options: { force?: boolean }) => {\r\n          await mapaReversao.carregar();\r\n\r\n          if (!options.force) {\r\n            console.log('‚ö†Ô∏è  ATEN√á√ÉO: Esta a√ß√£o ir√° remover todo o hist√≥rico de revers√£o.');\r\n            console.log('   N√£o ser√° poss√≠vel reverter moves futuros sem o hist√≥rico.');\r\n            console.log('');\r\n            console.log('Use --force para confirmar ou pressione Ctrl+C para cancelar.');\r\n            if (!process.env.VITEST) process.exit(1);\r\n            else {\r\n              process.exitCode = 1;\r\n              return;\r\n            }\r\n          }\r\n\r\n          await mapaReversao.limpar();\r\n          log.sucesso('üßπ Mapa de revers√£o limpo com sucesso');\r\n        }),\r\n    )\r\n    .addCommand(\r\n      new Command('status').description('Mostra status do mapa de revers√£o').action(async () => {\r\n        await mapaReversao.carregar();\r\n        const moves = mapaReversao.obterMoves();\r\n\r\n        console.log('üìä Status do Mapa de Revers√£o');\r\n        console.log('==============================');\r\n        console.log(`Total de moves: ${moves.length}`);\r\n\r\n        if (moves.length > 0) {\r\n          const ultimoMove = moves.sort(\r\n            (a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime(),\r\n          )[0];\r\n\r\n          console.log(`√öltimo move: ${new Date(ultimoMove.timestamp).toLocaleString('pt-BR')}`);\r\n          console.log(`Arquivo: ${ultimoMove.destino}`);\r\n          console.log(`Motivo: ${ultimoMove.motivo}`);\r\n        }\r\n\r\n        console.log('');\r\n        console.log('üí° Comandos dispon√≠veis:');\r\n        console.log('  oraculo reverter listar    - Lista todos os moves');\r\n        console.log('  oraculo reverter arquivo <arquivo> - Reverte moves de um arquivo');\r\n        console.log('  oraculo reverter move <id> - Reverte move espec√≠fico');\r\n        console.log('  oraculo reverter limpar --force - Limpa hist√≥rico');\r\n      }),\r\n    );\r\n}\r\n"]}