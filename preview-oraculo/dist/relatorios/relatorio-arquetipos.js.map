{"version":3,"file":"relatorio-arquetipos.js","sourceRoot":"","sources":["../../src/relatorios/relatorio-arquetipos.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\r\nimport type { ResultadoDeteccaoArquetipo } from '@tipos/tipos.js';\r\nimport { salvarEstado } from '@zeladores/util/persistencia.js';\r\nimport path from 'node:path';\r\n\r\nexport async function exportarRelatorioArquetiposMarkdown(\r\n  destino: string,\r\n  candidatos: ResultadoDeteccaoArquetipo[],\r\n  contexto?: { origem?: string },\r\n  detalhado = false,\r\n) {\r\n  const linhas: string[] = [];\r\n  linhas.push(`# Relatório de Detecção de Arquétipos`);\r\n  if (contexto?.origem) linhas.push(`*Origem: ${contexto.origem}*`);\r\n  linhas.push('');\r\n  linhas.push('| Arquétipo | Confiança (%) | Score | Explicação | Sugestão |');\r\n  linhas.push('|-----------|---------------|-------|------------|----------|');\r\n  for (const c of candidatos) {\r\n    if (!detalhado) {\r\n      // Relatório compacto\r\n      const missing = c.missingRequired?.slice(0, 3) || [];\r\n      const forbidden = c.forbiddenPresent?.slice(0, 3) || [];\r\n      const dependFalt =\r\n        c.dependencyMatches?.length === 0 && c.dependencyMatches !== undefined\r\n          ? c.dependencyMatches\r\n          : [];\r\n      let resumo = '';\r\n      if (missing.length) resumo += `Faltam pastas: ${missing.join(', ')}. `;\r\n      if (forbidden.length) resumo += `Estruturas proibidas: ${forbidden.join(', ')}. `;\r\n      if (dependFalt.length) resumo += `Dependências ausentes: ${dependFalt.join(', ')}. `;\r\n      if (c.sugestaoPadronizacao) resumo += c.sugestaoPadronizacao.replace(/\\n/g, ' ');\r\n      if (!resumo) resumo = 'Estrutura próxima do ideal.';\r\n      // Compacta explicação\r\n      const explicacao = (c.explicacaoSimilaridade || '').split('\\n').slice(0, 2).join(' ');\r\n      linhas.push(`| ${c.nome} | ${c.confidence} | ${c.score} | ${explicacao} | ${resumo} |`);\r\n    } else {\r\n      // Relatório detalhado enriquecido\r\n      linhas.push(`\\n## ${c.nome}`);\r\n      linhas.push(`Confiança: ${c.confidence} | Score: ${c.score}`);\r\n      linhas.push(`Explicação: ${c.explicacaoSimilaridade?.replace(/\\n/g, ' ')}`);\r\n      linhas.push(`Sugestão: ${c.sugestaoPadronizacao?.replace(/\\n/g, ' ')}`);\r\n      // Gravidade dos problemas\r\n      if (c.missingRequired?.length)\r\n        linhas.push(\r\n          `Pastas faltantes (gravidade: crítico): ${c.missingRequired.map((p) => `${p} [mkdir ${p}]`).join(', ')}`,\r\n        );\r\n      if (c.forbiddenPresent?.length)\r\n        linhas.push(`Estruturas proibidas (gravidade: risco): ${c.forbiddenPresent.join(', ')}`);\r\n      if (c.dependencyMatches?.length)\r\n        linhas.push(`Dependências detectadas: ${c.dependencyMatches.join(', ')}`);\r\n      if (c.filePatternMatches?.length)\r\n        linhas.push(`Padrões de arquivos: ${c.filePatternMatches.join(', ')}`);\r\n      if (c.anomalias?.length)\r\n        linhas.push(\r\n          `Anomalias: ${c.anomalias.map((a) => a.path + ' (' + a.motivo + ')').join(', ')}`,\r\n        );\r\n      // Sugestões automáticas de comandos/scripts\r\n      if (c.missingRequired?.length) {\r\n        linhas.push(`Sugestão de comandos:`);\r\n        c.missingRequired.forEach((p) => linhas.push(`  mkdir ${p}`));\r\n      }\r\n      // Dependências ausentes (simples)\r\n      if (c.dependencyMatches && Array.isArray(c.dependencyMatches)) {\r\n        const ausentes =\r\n          c.dependencyMatches.length === 0 && c.dependencyMatches !== undefined\r\n            ? c.dependencyMatches\r\n            : [];\r\n        if (ausentes.length) {\r\n          linhas.push(`Sugestão de comandos para dependências:`);\r\n          ausentes.forEach((dep) => linhas.push(`  npm install ${dep}`));\r\n        }\r\n      }\r\n      // Links para documentação oficial\r\n      if (c.nome) {\r\n        const docLinks: Record<string, string> = {\r\n          'api-rest-express': 'https://expressjs.com/pt-br/',\r\n          fullstack: 'https://nextjs.org/docs',\r\n          monorepo: 'https://turborepo.org/docs',\r\n          cli: 'https://nodejs.org/api/cli.html',\r\n          lib: 'https://www.typescriptlang.org/docs/',\r\n        };\r\n        if (docLinks[c.nome]) linhas.push(`Documentação oficial: ${docLinks[c.nome]}`);\r\n      }\r\n      // Frameworks detectados\r\n      if (c.dependencyMatches?.length) {\r\n        const fwLinks: Record<string, string> = {\r\n          express: 'https://expressjs.com/pt-br/',\r\n          react: 'https://react.dev/',\r\n          next: 'https://nextjs.org/docs',\r\n          electron: 'https://www.electronjs.org/docs',\r\n          'discord.js': 'https://discord.js.org/#/docs',\r\n          telegraf: 'https://telegraf.js.org/',\r\n        };\r\n        c.dependencyMatches.forEach((dep) => {\r\n          if (fwLinks[dep]) linhas.push(`Doc ${dep}: ${fwLinks[dep]}`);\r\n        });\r\n      }\r\n      // Práticas inseguras e smells (exemplo)\r\n      if (\r\n        c.explicacaoSimilaridade &&\r\n        /função longa|require dinâmico|import misto|eval/.test(c.explicacaoSimilaridade)\r\n      ) {\r\n        linhas.push(`Práticas inseguras detectadas: ${c.explicacaoSimilaridade}`);\r\n      }\r\n      // Dependências desatualizadas/vulneráveis (simples)\r\n      try {\r\n        const fs = await import('node:fs');\r\n        const pkgPath = path.resolve(process.cwd(), 'package.json');\r\n        if (fs.existsSync(pkgPath)) {\r\n          const pkg = JSON.parse(fs.readFileSync(pkgPath, 'utf-8'));\r\n          if (pkg.dependencies) {\r\n            for (const dep in pkg.dependencies) {\r\n              // Simulação: destaca dependências com versão \"0.\" ou \"^0.\" como desatualizadas/vulneráveis\r\n              if (/^0\\./.test(pkg.dependencies[dep]) || /^\\^0\\./.test(pkg.dependencies[dep])) {\r\n                linhas.push(\r\n                  `Dependência potencialmente desatualizada/vulnerável: ${dep} (${pkg.dependencies[dep]}) [grave]`,\r\n                );\r\n                linhas.push(`Sugestão: npm update ${dep}`);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      } catch {}\r\n      // Status do npm audit\r\n      try {\r\n        const { execSync } = await import('node:child_process');\r\n        const auditRaw = execSync('npm audit --json', { encoding: 'utf-8' });\r\n        const audit = JSON.parse(auditRaw);\r\n        if (audit.metadata?.vulnerabilities?.total > 0) {\r\n          linhas.push(`Vulnerabilidades detectadas pelo npm audit:`);\r\n          for (const [sev, qtd] of Object.entries(audit.metadata.vulnerabilities)) {\r\n            if (typeof qtd === 'number' && qtd > 0 && sev !== 'total') {\r\n              linhas.push(`  ${sev}: ${qtd}`);\r\n            }\r\n          }\r\n          linhas.push('Sugestão: npm audit fix');\r\n        } else {\r\n          linhas.push('Nenhuma vulnerabilidade encontrada pelo npm audit.');\r\n        }\r\n      } catch {}\r\n      linhas.push('---');\r\n    }\r\n  }\r\n  linhas.push('');\r\n  linhas.push('---');\r\n  linhas.push('**Como o diagnóstico foi feito:**');\r\n  linhas.push(\r\n    `A pontuação de cada arquétipo considera presença de pastas obrigatórias, opcionais, padrões de arquivos, dependências e penalidades por estruturas proibidas. O campo \"Explicação\" detalha os fatores que levaram à sugestão.`,\r\n  );\r\n  await salvarEstado(destino, linhas.join('\\n'));\r\n}\r\n\r\nexport async function exportarRelatorioArquetiposJson(\r\n  destino: string,\r\n  candidatos: ResultadoDeteccaoArquetipo[],\r\n  contexto?: { origem?: string },\r\n  detalhado = false,\r\n) {\r\n  const { criarRelatorioComVersao } = await import('../nucleo/schema-versao.js');\r\n\r\n  const relatorio = {\r\n    origem: contexto?.origem ?? null,\r\n    candidatos: candidatos.map((c) => {\r\n      if (!detalhado) {\r\n        // Compacto\r\n        const missing = c.missingRequired?.slice(0, 3) || [];\r\n        const forbidden = c.forbiddenPresent?.slice(0, 3) || [];\r\n        const dependFalt =\r\n          c.dependencyMatches?.length === 0 && c.dependencyMatches !== undefined\r\n            ? c.dependencyMatches\r\n            : [];\r\n        let resumo = '';\r\n        if (missing.length) resumo += `Faltam pastas: ${missing.join(', ')}. `;\r\n        if (forbidden.length) resumo += `Estruturas proibidas: ${forbidden.join(', ')}. `;\r\n        if (dependFalt.length) resumo += `Dependências ausentes: ${dependFalt.join(', ')}. `;\r\n        if (c.sugestaoPadronizacao) resumo += c.sugestaoPadronizacao.replace(/\\n/g, ' ');\r\n        if (!resumo) resumo = 'Estrutura próxima do ideal.';\r\n        // Compacta explicação\r\n        const explicacao = (c.explicacaoSimilaridade || '').split('\\n').slice(0, 2).join(' ');\r\n        return {\r\n          nome: c.nome,\r\n          confidence: c.confidence,\r\n          score: c.score,\r\n          explicacao,\r\n          resumo,\r\n          matchedRequired: c.matchedRequired?.slice(0, 3) || [],\r\n          missingRequired: missing,\r\n          forbiddenPresent: forbidden,\r\n          descricao: c.descricao,\r\n        };\r\n      } else {\r\n        // Detalhado\r\n        return {\r\n          nome: c.nome,\r\n          confidence: c.confidence,\r\n          score: c.score,\r\n          explicacao: c.explicacaoSimilaridade,\r\n          sugestao: c.sugestaoPadronizacao,\r\n          matchedRequired: c.matchedRequired,\r\n          missingRequired: c.missingRequired,\r\n          matchedOptional: c.matchedOptional,\r\n          dependencyMatches: c.dependencyMatches,\r\n          filePatternMatches: c.filePatternMatches,\r\n          forbiddenPresent: c.forbiddenPresent,\r\n          anomalias: c.anomalias,\r\n          descricao: c.descricao,\r\n        };\r\n      }\r\n    }),\r\n  };\r\n\r\n  // Criar relatório com versão\r\n  const relatorioVersionado = criarRelatorioComVersao(\r\n    relatorio,\r\n    undefined, // usar versão atual\r\n    'Relatório de detecção de arquétipos estruturais',\r\n  );\r\n\r\n  await salvarEstado(destino, relatorioVersionado);\r\n}\r\n"]}