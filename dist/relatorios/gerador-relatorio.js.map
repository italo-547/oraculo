{"version":3,"file":"gerador-relatorio.js","sourceRoot":"","sources":["../../src/relatorios/gerador-relatorio.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\r\n// Gerador de relat√≥rios: Markdown e JSON\r\nimport { formatMs } from '@nucleo/constelacao/format.js';\r\nimport { ResultadoInquisicaoCompleto, Ocorrencia } from '@tipos/tipos.js';\r\n\r\nexport async function gerarRelatorioMarkdown(\r\n  resultado: ResultadoInquisicaoCompleto,\r\n  outputPath: string,\r\n): Promise<void> {\r\n  const {\r\n    totalArquivos = 0,\r\n    ocorrencias = [],\r\n    guardian,\r\n    timestamp = Date.now(),\r\n    duracaoMs = 0,\r\n  } = (resultado || {}) as ResultadoInquisicaoCompleto;\r\n\r\n  const dataISO = new Date(timestamp).toISOString();\r\n  const ocorrenciasOrdenadas: Ocorrencia[] = [...ocorrencias].sort((a, b) => {\r\n    const ra = String(a.relPath ?? '');\r\n    const rb = String(b.relPath ?? '');\r\n    const cmp = ra.localeCompare(rb);\r\n    if (cmp !== 0) return cmp;\r\n    const la = typeof a.linha === 'number' ? a.linha : Number.MAX_SAFE_INTEGER;\r\n    const lb = typeof b.linha === 'number' ? b.linha : Number.MAX_SAFE_INTEGER;\r\n    return la - lb;\r\n  });\r\n\r\n  const guardianStatus =\r\n    guardian && typeof guardian === 'object' && 'status' in guardian\r\n      ? String((guardian as Record<string, unknown>).status)\r\n      : 'n√£o executada';\r\n\r\n  const guardianTimestamp =\r\n    guardian && typeof guardian === 'object' && 'timestamp' in guardian\r\n      ? String((guardian as Record<string, unknown>).timestamp)\r\n      : '‚Äî';\r\n\r\n  const guardianTotalArquivos =\r\n    guardian && typeof guardian === 'object' && 'totalArquivos' in guardian\r\n      ? String((guardian as Record<string, unknown>).totalArquivos)\r\n      : '‚Äî';\r\n\r\n  const header = `# üßæ Relat√≥rio Or√°culo\r\n\r\n**Data:** ${dataISO}  \r\n**Dura√ß√£o:** ${formatMs(duracaoMs)}  \r\n**Arquivos escaneados:** ${totalArquivos}  \r\n**Ocorr√™ncias encontradas:** ${ocorrencias.length}  \r\n\r\n---\r\n\r\n## üõ°Ô∏è Verifica√ß√£o de Integridade (Guardian)\r\n\r\n  - **Status:** ${guardianStatus}\r\n  - **Timestamp:** ${guardianTimestamp}\r\n  - **Total de arquivos protegidos:** ${guardianTotalArquivos}\r\n\r\n---\r\n\r\n---\r\n\r\n## üõ°Ô∏è Verifica√ß√£o de Integridade (Guardian)\r\n\r\n  - **Status:** ${guardianStatus}\r\n\r\n---\r\n\r\n## üö® Ocorr√™ncias Detalhadas\r\n\r\n| Arquivo | Linha | N√≠vel  | Mensagem |\r\n| ------- | ----- | ------ | -------- |\r\n${ocorrenciasOrdenadas\r\n  .map(\r\n    (o) =>\r\n      `| ${o.relPath} | ${o.linha ?? ''} | ${o.nivel ?? ''} | ${String(o.mensagem || '').replace(/\\|/g, '\\\\|')} |`,\r\n  )\r\n  .join('\\n')}\r\n`;\r\n\r\n  const { salvarEstado } = await import('../zeladores/util/persistencia.js');\r\n  await salvarEstado(outputPath, header);\r\n}\r\n\r\nexport async function gerarRelatorioJson(\r\n  resultado: ResultadoInquisicaoCompleto,\r\n  outputPath: string,\r\n): Promise<void> {\r\n  // Importar sistema de versionamento\r\n  const { criarRelatorioComVersao } = await import('../nucleo/schema-versao.js');\r\n\r\n  // Criar relat√≥rio versionado (mantemos metadados, mas salvamos os dados brutos para compatibilidade)\r\n  const relatorioVersionado = criarRelatorioComVersao(\r\n    resultado,\r\n    undefined,\r\n    'Relat√≥rio completo de diagn√≥stico do Or√°culo',\r\n  );\r\n\r\n  const { salvarEstado } = await import('../zeladores/util/persistencia.js');\r\n  await salvarEstado(outputPath, relatorioVersionado.dados ?? resultado);\r\n}\r\n"]}